---
title: "P8105 Homework 2"
author: "Maria Serafini"
date: "10/1/2025"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(readxl)
```


## Problem 1 

Import `pols_month.csv`, create and clean `pols_month_df`

```{r}
pols_month_df <- 
  read_csv("data/pols-month.csv", na = c("NA", "")) |> 
  janitor::clean_names() |> 
  separate(
    mon, into = c("year", "month", "day")) |> 
  mutate(
    month = case_match(
      month, 
      "01" ~ "January",
      "02" ~ "February",
      "03" ~ "March",
      "04" ~ "April", 
      "05" ~ "May", 
      "06" ~ "June", 
      "07" ~ "July", 
      "08" ~ "August", 
      "09" ~ "September", 
      "10" ~ "October", 
      "11" ~ "November", 
      "12" ~ "December"), 
    president = case_when(
      prez_gop == 1 ~ "gop",
      prez_dem == 1 ~ "dem")
    ) |> 
  select(-prez_gop, -prez_dem, -day)
```

Import `snp.csv`, create and clean `snp_df`

```{r}
snp_df <-
  read_csv("data/snp.csv", na = c("NA", "")) |> 
  janitor::clean_names() |> 
  mutate(
    date = mdy(date))|> 
  separate(
    date, into = c("year", "month", "day")) |>
  mutate(
    month = case_match(
      month, 
      "01" ~ "January",
      "02" ~ "February",
      "03" ~ "March",
      "04" ~ "April", 
      "05" ~ "May", 
      "06" ~ "June", 
      "07" ~ "July", 
      "08" ~ "August", 
      "09" ~ "September", 
      "10" ~ "October", 
      "11" ~ "November", 
      "12" ~ "December")
  ) |> 
  select(-day)
```

Import `unemployment.csv`, create and clean `unemployment_df`

```{r}
unemployment_df <-
  read_csv("data/unemployment.csv") |> 
  janitor::clean_names() |> 
  pivot_longer(
    cols = jan:dec, 
    names_to = "month",
    values_to = "unemploy_rate") |> 
  mutate(
    year = as.character(year),
    month = case_match(
      month, 
      "jan" ~ "January",
      "feb" ~ "February",
      "mar" ~ "March",
      "apr" ~ "April", 
      "may" ~ "May", 
      "jun" ~ "June", 
      "jul" ~ "July", 
      "aug" ~ "August", 
      "sep" ~ "September", 
      "oct" ~ "October", 
      "nov" ~ "November", 
      "dec" ~ "December")
    )
```

Join datasets `pols` and `snp`, merge `unemployment`

```{r}
pols_snp_df <-
  left_join(pols_month_df, snp_df, by = c("year", "month"))

pol_economy_df <-
  left_join(pols_snp_df, unemployment_df, by = c("year", "month"))

```

The dataset `pols-month` contained 822 observations of 9 variables related to the number of national politicians who are democratic or republican at any given time. The dataset `snp` contained 787 observations of 2 variables related to Standard & Poorâ€™s stock market index (S&P), often used as a representative measure of stock market as a whole and included two variables, `date` representing the date of the observation and `close` representing the closing value of the S&P on the associated date. The dataset `unemployment` contained 68 observations of 13 variables, including `year` representing the year of the measurement for each row of observation and the percentage of unemployment for each month of the associated year. 

The combined dataset `pol_economy_df` contains 822 observations of 11 variables representing political and economic data from `r min(pull(pols_month_df, year))` to `r max(pull(pols_month_df, year))`. Key variables include:
* `year` - the year of the observed measurement
* `month` - the month of the observed measurement
* `president` - the political party of the president at the time of the observed measurement
* `close` - the closing value of the S&P at the time of the observed measurement
* `unemploy_rate` - the percentage of unemployment at the time of the observed measurement


## Problem 2

Read and clean Mr. Trashwheel data

```{r}
mr_trash_df <-
  read_excel("data/202509 Trash Wheel Collection Data.xlsx", 
             sheet = "Mr. Trash Wheel", 
             range = "A2:N709",
             na = c("NA", "")) |> 
  janitor::clean_names() |> 
  pivot_longer(
    cols = plastic_bottles:sports_balls,
    names_to = "litter_type",
    values_to = "litter_type_count") |> 
  mutate(
    litter_type = case_match(
      litter_type,
      "plastic_bottles" ~ "plastic bottles",
      "polystyrene" ~ "polystyrene", 
      "cigarette_butts" ~ "cigarette butts", 
      "glass_bottles" ~ "glass bottles", 
      "plastic_bags" ~ "plastic bags", 
      "wrappers" ~ "wrappers",
      "sports_balls" ~ "sports balls"),
    litter_type_count = as.integer(litter_type_count),
    trash_wheel = "mr") |> 
  select(-month, -year) |> 
  separate(
    date, into = c("collection_year", "collection_month", "collection_day")) |> 
  rename(
    total_weight = weight_tons, 
    total_volume = volume_cubic_yards,
    dumpster_number = dumpster) |> 
  relocate(trash_wheel, .after = dumpster_number)
```

read and clean`professor trashwheel` data

```{r}
prof_trash_df <-
  read_excel("data/202509 Trash Wheel Collection Data.xlsx", 
             sheet = "Professor Trash Wheel", 
             range = "A2:M134",
             na = c("NA", "")) |> 
  janitor::clean_names() |> 
  pivot_longer(
    cols = plastic_bottles:wrappers,
    names_to = "litter_type",
    values_to = "litter_type_count") |> 
  mutate(
    litter_type = case_match(
      litter_type,
      "plastic_bottles" ~ "plastic bottles",
      "polystyrene" ~ "polystyrene", 
      "cigarette_butts" ~ "cigarette butts", 
      "glass_bottles" ~ "glass bottles", 
      "plastic_bags" ~ "plastic bags", 
      "wrappers" ~ "wrappers"),
    litter_type_count = as.integer(litter_type_count),
    trash_wheel = "prof") |> 
  select(-month, -year) |> 
  separate(
    date, into = c("collection_year", "collection_month", "collection_day")) |> 
  rename(
    total_weight = weight_tons, 
    total_volume = volume_cubic_yards,
    dumpster_number = dumpster) |> 
  relocate(trash_wheel, .after = dumpster_number)
```

read and clean `gywnnda trashwheel` data

```{r}
gywnnda_trash_df <-
  read_excel("data/202509 Trash Wheel Collection Data.xlsx", 
             sheet = "Gwynns Falls Trash Wheel", 
             range = "A2:L351",
             na = c("NA", "")) |> 
  janitor::clean_names() |> 
  pivot_longer(
    cols = plastic_bottles:wrappers,
    names_to = "litter_type",
    values_to = "litter_type_count") |> 
  mutate(
    litter_type = case_match(
      litter_type,
      "plastic_bottles" ~ "plastic bottles",
      "polystyrene" ~ "polystyrene", 
      "cigarette_butts" ~ "cigarette butts", 
      "plastic_bags" ~ "plastic bags", 
      "wrappers" ~ "wrappers"),
    litter_type_count = as.integer(litter_type_count),
    trash_wheel = "gywnnda") |> 
  select(-month, -year) |> 
  separate(
    date, into = c("collection_year", "collection_month", "collection_day")) |> 
  rename(
    total_weight = weight_tons, 
    total_volume = volume_cubic_yards,
    dumpster_number = dumpster) |> 
  relocate(trash_wheel, .after = dumpster_number)
  
```

merge datasets and save total litter for mr trash wheel for inline printing

```{r}
trash_wheel_df <- bind_rows(mr_trash_df, prof_trash_df, gywnnda_trash_df)
```

__The `trash wheel` dataframe has 7486 observations of 10 variables.__

* `dumpster_number` - number of the dumpster
* `trash_wheel` - the specific water-wheel vessel that collected the litter (mr, prof, gywnnda)
* `collection_year` - the year of the litter collection (`r range(pull(trash_wheel_df, collection_year))`)
* `collection_month` - the month of the litter collection
* `collection_day` - the day of the litter collection
* `total_weight` - total weight of litter collected from a given dumpster on the given collection date 
* `total_volume` - total volume of litter collected from a given dumpster on the given collection date 
* `homes_powered` - number of homes powered by the incineration of the collected litter
* `litter_type` - the type of litter (plastic bottles, polystyrene, cigarette butts, glass bottles, plastic bags, wrappers, sports balls)
* `litter_count` - the count of the litter type from a given dumpster on the given collection date

The total weight of litter collected by mr trash wheel was `2,283.84` tons. 
The total number of cigarette butts collected by gywnnda trash wheel in june of 2022 was `18,120`.


## Problem 3 

import and clean zillow zori data for NYC

```{r}
zori_df <-
  read_csv("data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv", na = c("NA", "")) |>
  pivot_longer(
    cols = matches("^20\\d{2}-\\d{2}-\\d{2}$"),
    names_to = "obs_date",
    values_to = "zori") |> 
  janitor::clean_names() |> 
  rename(
    zip_code = region_name) |> 
  select(-region_type, -state_name) |> 
  relocate(zip_code) |> 
  mutate(
    county = str_remove(county_name, "\\County")
  ) |> 
  select(-county_name)
```

import and clean zip data for NYC

```{r}
zip_codes_df <-
  read_csv("data/Zip Codes.csv", na = c("NA", "")) |> 
  janitor::clean_names() |> 
  relocate(zip_code) |> 
  select(-state_fips, -county_code, -county_fips, -file_date, -county)
```

merge datasets

```{r}
zori_zip_df <- 
  left_join(zori_df, zip_codes_df, by = "zip_code", relationship = "many-to-many") |> 
  select(metro, state, city, county, zip_code, neighborhood, obs_date, zori)
```

